<div class="release-present">
  <%= image_tag(@release.avatar.url, class: "release-avatar left-avatar") if @release.avatar.present? %>
  
  <div class="release-bgrd">
    <%#= image_tag 'dj.jpg' %>

    <div class="release-header">
      <div class="release-exclusive">
        <%= image_tag 'icons/user-logo-icon.svg' %>
        <div>ONLY ON<br>
        BIRDFEED</div>
      </div>
      <%= link_to download_release_path(@release) do %>
        <%= image_tag('icons/icon-download.svg', class: "release-icon", title: "Download") %>
      <% end %>

      <a href="#" title="Share" tabindex="0" data-toggle="popover" data-placement="left" data-content="<%= (social_share_button_tag(@release.title, desc: @release.text)).gsub('\"','\'') %>" data-trigger="focus" data-html="true" onclick="return false;">
        <%= image_tag('icons/icon-share.svg', class: "release-icon", title: "Share") %>
      </a>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-8">

    <div class="release-info mb-4">
      <h1><%= @release.title.upcase %></h1>
      <p class="release-date">Released date: <%= time_ago_in_words( @release.release_date ) %> ago</p>

      <div class="truncated-description">
        <% if @release.text.present? %>
          <article><%= @release.text.html_safe.truncate(400) %></article>

          <% if @release.text.html_safe.truncate(400) != @release.text.html_safe %>
            <a href="#" class="truncated-long">Read more</a>
          <% end %>

          <article><%= @release.text.html_safe %></article>
          <a href="#" class="truncated-short"><br><br>Read less</a>
        <% end %>
      </div>

      <%= render 'follows/follow_button', target: @release %>
      
      <%= link_to "Q&A", chirp_path, class: "btn c-btn-transparent btn-wide" %>
    </div>

    <div class="c-panel bg-white">
      <div class="c-flag mb-4">COMMENT FEED</div>
        <button class="btn c-btn-blue mt-1" type="button" data-toggle="modal" data-target="#addcommentModal">
          ADD YOUR COMMENT
        </button>
      <div class="feed-block light-scroll">
        <%= render 'feeds/user' %>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <% if @release.tracks.any? %>
      <div class="c-panel bg-white">
        <div class="c-flag c-flag-inner mb-4">TRACKS</div>

        <ol class="light-scroll list-unstyled mt-1">
          <% @release.tracks.each do |track| %>
            <li class="track-item">
              <h3>
                <%= track.title.truncate(70).upcase %>
                <%= render 'likes/like_button', object: track %>
              </h3>

              By <%= track.users.pluck(:name).join(' feat. ') %>

              <%= render 'layouts/artist_player', object: track %>

              <%= link_to image_tag('icons/icon-download.svg'), download_track_path, class: "icon-download" %>

              <a href="#" title="Share" tabindex="0" data-toggle="popover" data-placement="left" data-content="<%= (social_share_button_tag(track.title, desc: track.title)).gsub('\"','\'') %>" data-trigger="focus" data-html="true" onclick="return false;" class="icon-share">
                <%= image_tag('icons/icon-share.svg', title: "Share") %>
              </a>
            </li>
          <% end %>
        </ol>
      </div>
    <% end %>
  </div>
</div>

<% if current_user %>
  <% content_for :body_area do %>
    <div class="modal modal-blured" id="addcommentModal" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-wide" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <h5 class="modal-title">Add your comment</h5>

            <%= form_for current_user.comments.build, html: { class: "feed-form" } do |f| %>
              <%= f.hidden_field :commentable_type, value: "Release" %>
              <%= f.hidden_field :commentable_id, value: @release.id %>
              <%= f.label :title, class: "sr-only" %>
              <%= f.text_field :title, placeholder: "Type the title here" %>
              <%= f.label :body, class: "sr-only" %>
              <%= f.text_area :body, rows: 10, placeholder: "Type text", max: 200 %>
              <%= f.submit "ADD TO FEED", class: "btn c-btn-blue btn-wide" %>
            <% end %>

          </div>
        </div>
      </div>
    </div>
  <% end %>
<% end %>
